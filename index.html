<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GeoTransport</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #5d5fef; --bg: #f8f9ff; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .header { background: white; padding: 20px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); z-index: 1000; }
        .header h1 { margin: 0; font-size: 20px; color: #2d3142; }
        #map { flex: 1; width: 100%; z-index: 1; }
        .panel { background: white; height: 45%; border-radius: 35px 35px 0 0; padding: 20px; overflow-y: auto; z-index: 1000; box-shadow: 0 -8px 20px rgba(0,0,0,0.05); }
        .card { background: #fff; border: 1px solid #f0f2f8; padding: 15px; border-radius: 20px; display: flex; align-items: center; margin-bottom: 12px; }
        .icon { width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
    </style>
</head>
<body>

<div class="header">
    <h1 id="loc-name">áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</h1>
    <span id="status" style="font-size: 12px; color: #9196b2;">áƒ•áƒ”áƒ«áƒ”áƒ‘ áƒšáƒáƒ™áƒáƒªáƒ˜áƒáƒ¡...</span>
</div>

<div id="map"></div>

<div class="panel">
    <b style="display:block; margin-bottom:15px;">áƒ£áƒáƒ®áƒšáƒáƒ”áƒ¡áƒ˜ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜</b>
    <div id="list" style="text-align:center; color:#999; padding-top:30px;">
        áƒ©áƒáƒ áƒ—áƒ”áƒ— GPS áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒœáƒáƒ®áƒáƒ•áƒáƒ“
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map = L.map('map', {zoomControl: false}).setView([42.3, 42.7], 7);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
    let userMarker;

    function init() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(async (pos) => {
                const { latitude: lat, longitude: lon } = pos.coords;
                
                document.getElementById('status').innerText = "áƒšáƒáƒ™áƒáƒªáƒ˜áƒ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ";
                map.flyTo([lat, lon], 16);
                
                if (userMarker) map.removeLayer(userMarker);
                userMarker = L.circleMarker([lat, lon], {radius: 8, color: '#fff', fillColor: '#5d5fef', fillOpacity: 1, weight: 3}).addTo(map);

                updateData(lat, lon);
            }, (err) => {
                document.getElementById('list').innerHTML = "<b style='color:#5d5fef'>áƒ’áƒ—áƒ®áƒáƒ•áƒ—, áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ¨áƒ˜ áƒ©áƒáƒ áƒ—áƒáƒ— Location: Allow</b>";
            }, { enableHighAccuracy: true });
        }
    }

    async function updateData(lat, lon) {
        // áƒ¥áƒáƒšáƒáƒ¥áƒ˜áƒ¡ áƒáƒ›áƒáƒªáƒœáƒáƒ‘áƒ (áƒ›áƒáƒ’. áƒ–áƒ£áƒ’áƒ“áƒ˜áƒ“áƒ˜)
        const cityRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
        const cityData = await cityRes.json();
        document.getElementById('loc-name').innerText = cityData.address.city || cityData.address.town || "áƒ–áƒ£áƒ’áƒ“áƒ˜áƒ“áƒ˜";

        // áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ‘áƒáƒ–áƒ˜áƒ“áƒáƒœ
        const query = `[out:json];node["highway"="bus_stop"](around:1000,${lat},${lon});out;`;
        const stopRes = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`);
        const stopData = await stopRes.json();
        
        const list = document.getElementById('list');
        list.innerHTML = '';

        if (stopData.elements.length === 0) {
            list.innerHTML = "áƒáƒ®áƒšáƒáƒ›áƒáƒ®áƒšáƒ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ";
            return;
        }

        stopData.elements.forEach(s => {
            list.innerHTML += `
                <div class="card">
                    <div class="icon">ğŸš</div>
                    <div>
                        <b>${s.tags.name || "áƒáƒ•áƒ¢áƒáƒ‘áƒ£áƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ"}</b><br>
                        <small style="color:gray">áƒ›áƒ£áƒœáƒ˜áƒªáƒ˜áƒáƒáƒšáƒ£áƒ áƒ˜ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</small>
                    </div>
                </div>`;
        });
    }

    window.onload = init;
</script>
</body>
</html>






