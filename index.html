<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GeoTransport Live</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --main: #5d5fef; --bg: #f4f7ff; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* áƒ–áƒ”áƒ“áƒ áƒ—áƒ”áƒ—áƒ áƒ˜ áƒ‘áƒšáƒáƒ™áƒ˜ */
        .header { background: white; padding: 25px 20px; border-radius: 0 0 35px 35px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); z-index: 1000; }
        .header h1 { margin: 0; font-size: 22px; color: #2d3142; }
        .header p { margin: 5px 0 0; font-size: 13px; color: #9196b2; }
        
        /* áƒ áƒ£áƒ™áƒ - áƒ˜áƒ™áƒáƒ•áƒ”áƒ‘áƒ¡ áƒ¨áƒ£áƒ áƒœáƒáƒ¬áƒ˜áƒšáƒ¡ */
        #map { flex: 1; width: 100%; z-index: 1; }

        /* áƒ¥áƒ•áƒ”áƒ“áƒ áƒáƒáƒœáƒ”áƒšáƒ˜ */
        .panel { background: white; height: 45%; border-radius: 40px 40px 0 0; padding: 20px; overflow-y: auto; z-index: 1000; box-shadow: 0 -10px 25px rgba(0,0,0,0.05); }
        .card { background: #fff; border: 1px solid #f0f2f8; padding: 15px; border-radius: 20px; display: flex; align-items: center; margin-bottom: 12px; }
        .icon { width: 45px; height: 45px; background: var(--main); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 15px; }
        .info b { font-size: 15px; display: block; color: #2d3142; }
        .info span { font-size: 12px; color: #9196b2; }

        /* GPS áƒ«áƒ˜áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒœáƒ˜áƒ›áƒáƒªáƒ˜áƒ */
        .loader { text-align: center; color: var(--main); font-weight: bold; padding-top: 50px; }
    </style>
</head>
<body onload="startGPS()">

<div class="header">
    <h1 id="city-title">áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</h1>
    <p id="city-subtitle">áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ”áƒáƒ‘áƒ¡ áƒšáƒáƒ™áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ“áƒáƒ“áƒ’áƒ”áƒœáƒ...</p>
</div>

<div id="map"></div>

<div class="panel">
    <b style="font-size: 18px; display: block; margin-bottom: 15px;">áƒ£áƒáƒ®áƒšáƒáƒ”áƒ¡áƒ˜ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜</b>
    <div id="list" class="loader">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ“áƒáƒ”áƒ—áƒáƒœáƒ®áƒ›áƒáƒ— GPS-áƒ¡...</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map = L.map('map', { zoomControl: false }).setView([42.3, 42.7], 7);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    function startGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(async pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;

                map.flyTo([lat, lon], 16);
                L.circleMarker([lat, lon], {radius: 8, color: '#fff', fillColor: '#5d5fef', fillOpacity: 1, weight: 3}).addTo(map);

                // áƒ¥áƒáƒšáƒáƒ¥áƒ˜áƒ¡ áƒ“áƒ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒáƒ•áƒœáƒ
                updateUI(lat, lon);
            }, err => {
                document.getElementById('list').innerHTML = "áƒ©áƒáƒ áƒ—áƒ”áƒ— GPS áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ";
            }, { enableHighAccuracy: true });
        }
    }

    async function updateUI(lat, lon) {
        // 1. áƒ¥áƒáƒšáƒáƒ¥áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ (áƒ›áƒáƒ’. áƒ–áƒ£áƒ’áƒ“áƒ˜áƒ“áƒ˜)
        const resCity = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
        const dataCity = await resCity.json();
        const city = dataCity.address.city || dataCity.address.town || dataCity.address.village || "áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ";
        document.getElementById('city-title').innerText = city;
        document.getElementById('city-subtitle').innerText = "áƒ áƒ”áƒáƒšáƒ£áƒ áƒ˜ áƒ“áƒ áƒáƒ˜áƒ¡ áƒ áƒ”áƒŸáƒ˜áƒ›áƒ˜";

        // 2. áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜ (áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒ•áƒ˜áƒ¡)
        const query = `[out:json];node["highway"="bus_stop"](around:800,${lat},${lon});out;`;
        const resStops = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`);
        const dataStops = await resStops.json();
        
        const list = document.getElementById('list');
        list.innerHTML = '';
        list.classList.remove('loader');

        if(dataStops.elements.length === 0) {
            list.innerHTML = "áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ";
            return;
        }

        dataStops.elements.forEach(s => {
            list.innerHTML += `
                <div class="card">
                    <div class="icon">ğŸš</div>
                    <div class="info">
                        <b>${s.tags.name || "áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ"}</b>
                        <span>áƒ›áƒ£áƒœáƒ˜áƒªáƒ˜áƒáƒáƒšáƒ£áƒ áƒ˜ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</span>
                    </div>
                </div>`;
        });
    }
</script>
</body>
</html>





